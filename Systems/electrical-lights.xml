<?xml version="1.0"?>
<!--
    usable with flightgear or JSBSim stand-alone
    COPYRIGHT gerard robin  23-03-2010




-->

<system name="instruments-lights">
    <property>systems/effets/lights/blinker-kinemat-out</property>


    <channel name="lights">
        <switch name="instruments factor SW">
            <default value="0"/>
            <test  logic="AND" value="1">
                /controls/electric/master-switch == 1
                /systems/electrical/outputs/instrument-lights gt 27
            </test>
            <output>fcs/instruments-factor</output>
            <output>/instrumentation/nav[0]/power-btn</output>
            <output>/instrumentation/nav[1]/power-btn</output>
        </switch>

        <fcs_function name="Instrument Lighting">
            <function>
                <sum>
                    <product>
                        <property>fcs/instruments-factor</property>
                        <property>/sim/model/Aircraft/lighting/instrument-lights</property>
                        <property>/sim/time/sun-angle-rad</property>
                    </product>
                </sum>
            </function>
            <output>/controls/lighting/instruments-norm</output>
        </fcs_function>

        <!--<pure_gain name="instruments lighting">
            <input>fcs/instruments-factor</input>
            <gain>/sim/model/Aircraft/lighting/instrument-lights</gain>
            <output>/controls/lighting/instruments-norm</output>
        </pure_gain>-->

    </channel>

    <channel name="light-outdoor">

        <switch name="Landing Light">
            <default value="0"/>
            <test logic="AND" value="1">
                fcs/gear-pos-norm  == 1
               <!-- /controls/lighting/landing-lights == 1-->
                <!--/controls/switches/landing-light  == 1-->
                /systems/electrical/outputs/landing-light  gt 24
            </test>
        </switch>


        <!--FIXME temporaire fonction à revoir plus élaborée-->
        <switch name="Beacon">
            <default value="0"/>
            <test logic="AND" value="1">
                /controls/electric/master-switch == 1
            </test>
            <output>/controls/switches/flashing-beacon</output>
        </switch>

        <switch name="blinker-sw">
            <default value="systems/effets/lights/blinker-kinemat-in"/>
            <test logic="AND" value="1">
                systems/effets/lights/blinker-kinemat-in == 0
                systems/effets/lights/blinker-kinemat-out == 0
            </test>
            <test logic="AND" value="0">
                systems/effets/lights/blinker-kinemat-in == 1
                systems/effets/lights/blinker-kinemat-out == 1
            </test>
            <output>systems/effets/lights/blinker-kinemat-in</output>
            <output>/instrumentation/lights/blinker-kinemat-in</output>
        </switch>

        <kinematic name="blinker-norm">
            <input>systems/effets/lights/blinker-kinemat-in</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>0</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>1</time>
                </setting>
            </traverse>
            <output>systems/effets/lights/blinker-kinemat-out</output>
            <output>/instrumentation/lights/blinker-kinemat-out</output>
        </kinematic>

        <switch name="beacon1-sw">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/effets/lights/blinker-kinemat-out gt 0.90
                systems/effets/lights/blinker-kinemat-out lt 0.97
                /controls/switches/flashing-beacon == 1
            </test>
            <output>systems/effets/lights/beacon1-on</output>
        </switch>

        <switch name="beacon2-sw">
            <default value="1"/>
            <test logic="AND" value="0">
                systems/effets/lights/blinker-kinemat-out gt 0.03
                systems/effets/lights/blinker-kinemat-out lt 0.10
                /controls/switches/flashing-beacon == 1
            </test>
            <output>systems/effets/lights/beacon2-on</output>
        </switch>

        <switch name="beacon-sw">
            <default value="0"/>
            <test logic="AND" value="1">
                /instrumentation/lights/blinker-kinemat-out > 0.90
                /instrumentation/lights/blinker-kinemat-out lt 0.97
                /controls/switches/flashing-beacon == 1
            </test>
            <output>/instrumentation/lights/beacon-on</output>
        </switch>


    </channel>


</system>
